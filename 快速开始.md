# WPIC 图床后端 - 快速开始指南

## 🚀 5分钟快速体验

### 1. 环境准备
```bash
# 确保Python版本 3.8+
python --version

# 克隆或下载项目到本地
# 进入项目目录
cd wpic
```

### 2. 安装依赖
```bash
# 安装Python依赖
pip install -r requirements.txt
```

### 3. 配置环境
```bash
# 复制配置文件
cp config.example.env .env

# 编辑配置（可选，默认配置即可运行）
# nano .env
```

### 4. 启动服务
```bash
# 直接运行
python main.py

# 或使用启动脚本
chmod +x run.sh
./run.sh

# 或使用Docker
docker-compose up -d
```

### 5. 访问服务
- **API文档**: http://localhost:8000/docs
- **健康检查**: http://localhost:8000/health
- **服务信息**: http://localhost:8000/info

## 🧪 功能测试

### 方式1：使用API文档界面
1. 打开 http://localhost:8000/docs
2. 点击 "Try it out" 按钮测试各个接口

### 方式2：使用测试脚本
```bash
python test_api.py
```

### 方式3：使用HTTP文件
在VS Code中安装REST Client插件，然后打开 `test_main.http` 文件进行测试。

## 📋 主要功能验证

### 1. 用户注册
```bash
curl -X POST "http://localhost:8000/api/auth/register" \
  -H "Content-Type: application/json" \
  -d '{
    "username": "testuser",
    "email": "test@example.com", 
    "password": "password123"
  }'
```

### 2. 用户登录
```bash
curl -X POST "http://localhost:8000/api/auth/login" \
  -H "Content-Type: application/x-www-form-urlencoded" \
  -d "username=testuser&password=password123"
```

### 3. 上传图片
```bash
curl -X POST "http://localhost:8000/api/files/upload" \
  -H "Authorization: Bearer YOUR_TOKEN" \
  -F "file=@your_image.jpg"
```

### 4. 查看文件列表
```bash
curl -X GET "http://localhost:8000/api/files/" \
  -H "Authorization: Bearer YOUR_TOKEN"
```

## 🔧 配置说明

### 基础配置
```env
# 应用配置
APP_HOST=0.0.0.0
APP_PORT=8000
APP_DEBUG=false

# 数据库（默认SQLite）
DB_DATABASE_URL=sqlite:///./wpic.db

# Redis缓存（可选）
REDIS_HOST=localhost
REDIS_PORT=6379

# 安全配置
SECURITY_SECRET_KEY=your-secret-key
SECURITY_ENABLE_AUTH=true
```

### 存储配置

#### 本地存储（默认）
```env
STORAGE_LOCAL_BASE_PATH=./uploads
```

#### S3存储
```env
STORAGE_S3_ACCESS_KEY=your-access-key
STORAGE_S3_SECRET_KEY=your-secret-key
STORAGE_S3_BUCKET=your-bucket
STORAGE_S3_REGION=us-east-1
```

#### WebDAV存储
```env
STORAGE_WEBDAV_URL=https://your-webdav-server.com
STORAGE_WEBDAV_USERNAME=username
STORAGE_WEBDAV_PASSWORD=password
```

## ❓ 常见问题

### Q: 启动时报错 "ModuleNotFoundError"
A: 请确保已安装所有依赖：`pip install -r requirements.txt`

### Q: Redis连接失败
A: 
1. 确保Redis服务已启动
2. 检查Redis配置是否正确
3. 或者暂时注释掉Redis相关配置

### Q: 数据库连接错误
A: 默认使用SQLite，无需额外配置。如使用PostgreSQL/MySQL，请确保数据库服务运行正常。

### Q: 文件上传失败
A: 
1. 检查上传目录权限
2. 确认文件大小未超限
3. 验证文件格式是否支持

### Q: 图片缩略图生成失败
A: 确保已安装PIL/Pillow图像处理库

## 🛠️ 开发模式

### 启用调试模式
```env
APP_DEBUG=true
```

### 查看日志
```bash
# 直接运行可看到详细日志
python main.py

# 或使用uvicorn
uvicorn main:app --reload --log-level debug
```

### 数据库操作
```python
# 进入Python交互环境
python

# 创建数据库表
from app.database import create_all_tables
import asyncio
asyncio.run(create_all_tables())
```

## 📈 性能优化

### 生产环境建议
1. 使用PostgreSQL或MySQL数据库
2. 配置Redis缓存
3. 使用反向代理（Nginx）
4. 启用HTTPS
5. 配置CDN加速

### 监控和日志
- 健康检查: `/health`
- 系统信息: `/info`
- API文档: `/docs`

## 🤝 获取帮助

1. 查看完整文档: `README.md`
2. 检查API文档: http://localhost:8000/docs
3. 查看配置示例: `config.example.env`
4. 运行测试脚本: `python test_api.py`

---

🎉 **恭喜！** 你的WPIC图床后端已经成功运行！
